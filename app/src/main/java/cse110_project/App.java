/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package cse110_project;

import java.io.*;
import java.util.ArrayList;
import org.json.JSONObject;
import java.util.Collections;
import java.io.IOException;
import java.net.HttpURLConnection;
import java.net.URI;
import java.net.URISyntaxException;
import java.net.URL;

import javafx.application.Application;
import javafx.event.ActionEvent;
import javafx.scene.control.TextArea;
import javafx.stage.Stage;
import javafx.scene.Scene;
import javafx.scene.control.Button;
import javafx.scene.control.Label;
import javafx.scene.control.ScrollPane;
import java.nio.file.Files;
import java.nio.file.NoSuchFileException;

import javafx.scene.control.TextField;
import java.nio.file.Paths;
import javafx.scene.control.ScrollPane.ScrollBarPolicy;
import javafx.scene.layout.VBox;
import javafx.scene.layout.BorderPane;
import javafx.scene.layout.HBox;
import javafx.scene.layout.Priority;
import javafx.scene.layout.Region;
import javafx.scene.layout.StackPane;
import javafx.geometry.Insets;
import javafx.geometry.Pos;
import javafx.scene.image.Image;
import javafx.scene.image.ImageView;
import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;

class postRecipeCreate extends VBox {

    public String rName;
    public String rDesc;
    public RecipeKind rKind;

    private Button saveRecipeButton;
    private Button editRecipeButton;
    private Button backButton;
    private TextArea recipeDescription;
    private Stage postCreateStage;
    private Scene scene;
    private boolean editflag;

    // display the generated recipe description in a new popout window
    // pmt = passed meal type, pml = passed meal ingredient list
    public postRecipeCreate(String pmt, String pml) {
        JSONObject toSend = new JSONObject();
        toSend.put("pmt", pmt);
        toSend.put("pml", pml);
        try {
            HttpClient client = HttpClient.newHttpClient();
            // Create the request object
            HttpRequest request = HttpRequest
                    .newBuilder()
                    .uri(new URI(App.serverURL + "/genrecipe"))
                    .header("Content-Type", "application/json")
                    .POST(HttpRequest.BodyPublishers.ofString(toSend.toString())).build();
            // Send the request and receive the response
            HttpResponse<String> response = client.send(request, HttpResponse.BodyHandlers.ofString());
            // Process the response
            String responseBody = response.body();
            JSONObject responseJson = new JSONObject(responseBody);
            rName = responseJson.getString("name");
            rDesc = responseJson.getString("desc");
            rKind = RecipeKind.valueOf(responseJson.getString("kind"));
        } catch (Exception e) {
            System.err.println("Failed to generate");
            e.printStackTrace();
        }

        postCreateStage = new Stage();
        recipeDescription = new TextArea();
        recipeDescription.setWrapText(true);
        recipeDescription.appendText(rDesc);
        editflag = false;
        recipeDescription.setEditable(editflag);

        saveRecipeButton = new Button("save");
        saveRecipeButton.setPrefSize(45, 15);
        saveRecipeButton.setAlignment(Pos.CENTER);

        editRecipeButton = new Button("edit");
        editRecipeButton.setPrefSize(45, 15);
        editRecipeButton.setAlignment(Pos.CENTER);

        backButton = new Button("back");
        backButton.setPrefSize(45, 15);
        backButton.setAlignment(Pos.CENTER);

        this.setPrefSize(500, 500);
    }

    public void postRecipeCreateDisplay(App app) {
        saveRecipeButton.setOnAction(e -> {
            String updatedDesc = recipeDescription.getText();
            Recipe newRecipe = new Recipe(rName, updatedDesc, rKind);

            app.addRecipeUI(newRecipe);
            app.getState().addRecipe(newRecipe);
            app.writeServerState();

            postCreateStage.close();
        });
        editRecipeButton.setOnAction(e -> {
            if (editflag == false) {
                editflag = true;
                recipeDescription.setEditable(editflag);
            } else {
                editflag = false;
                recipeDescription.setEditable(editflag);
            }
        });
        backButton.setOnAction(e -> {
            postCreateStage.close();
        });

        HBox buttonArea = new HBox();
        buttonArea.getChildren().addAll(saveRecipeButton, editRecipeButton, backButton);
        buttonArea.setPadding(new Insets(10, 10, 10, 10));
        buttonArea.setSpacing(199);

        VBox recipeDetail = new VBox();
        recipeDetail.getChildren().addAll(recipeDescription);
        recipeDetail.setPadding(new Insets(10, 10, 10, 10));

        VBox recipeImage = new VBox();
        String fimg = "data:image/jpeg;base64,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";
        Image foodImg = new Image(fimg);
        ImageView imageView = new ImageView(foodImg);
        recipeImage.getChildren().addAll(imageView);
        recipeImage.setAlignment(Pos.CENTER);

        ScrollPane sp = new ScrollPane(recipeDetail);
        sp.setHbarPolicy(ScrollBarPolicy.AS_NEEDED);
        sp.setVbarPolicy(ScrollBarPolicy.AS_NEEDED);

        this.getChildren().addAll(buttonArea, sp, recipeImage);

        scene = new Scene(this, 550, 550);

        postCreateStage.setTitle("Generated Recipe");
        postCreateStage.setResizable(false);
        postCreateStage.setScene(scene);
        postCreateStage.show();
    }
}

// This class creates prompts for user input
class Prompt extends HBox {
    private Label prompt;
    private Button micButton;
    private boolean isRecord;

    Prompt() {
        prompt = new Label();
        prompt.setPrefSize(500, 250);
        prompt.setWrapText(true);
        prompt.setStyle("-fx-border-color: black; -fx-border-width: 1;");
        prompt.setAlignment(Pos.CENTER);

        micButton = new Button("Record");
        micButton.setMinHeight(250);

        this.getChildren().addAll(prompt, micButton);
        this.setAlignment(Pos.CENTER);
    }

    public void toggleRecord() {
        if (!isRecord) {
            isRecord = true;
        } else {
            isRecord = false;
        }
    }

    public Button getMicButton() {
        return this.micButton;
    }

    public void setLabel(String text) {
        prompt.setText(text);
    }

    public boolean getRecordStatus() {
        return isRecord;
    }
}

class newScreen extends VBox {

    private static final String RESPONSE = "Your response is: ";
    private static final String MEAL_PROMPT = "Please select your meal type: Breakfast, Lunch, or Dinner";
    private static final String INGREDIENT_PROMPT = "Please list the ingredients you have";

    private Prompt mealPrompt;
    private Prompt ingredientPrompt;

    private Button mealTypeMicButton;
    private Button ingredientMicButton;
    private Button doneButton;

    private Label recordingLabel;

    private AudioRecord aRecord;

    private Stage inputStage;

    private Scene scene;

    private postRecipeCreate prc;

    private String mealType = "";
    private String mealList = "";

    String defaultLabelStyle = "-fx-font: 13 arial; -fx-pref-width: 175px; -fx-pref-height: 50px; -fx-text-fill: red; visibility: hidden";

    newScreen() {
        inputStage = new Stage();

        recordingLabel = new Label("Recording...");
        recordingLabel.setAlignment(Pos.BOTTOM_CENTER);
        recordingLabel.setStyle(defaultLabelStyle);

        aRecord = new AudioRecord(recordingLabel);

        this.setAlignment(Pos.TOP_CENTER);
        this.setPrefSize(500, 800);

        doneButton = new Button("Done");
        doneButton.setDisable(true);

        mealPrompt = new Prompt();
        ingredientPrompt = new Prompt();

        mealTypeMicButton = mealPrompt.getMicButton();
        ingredientMicButton = ingredientPrompt.getMicButton();
    }

    public void voiceInputScreen(App app) {
        mealPrompt.setLabel(MEAL_PROMPT);

        // Record and display user's response for meal type
        mealTypeMicButton.setOnAction(e -> {
            try {
                mealPrompt.toggleRecord();
                if (mealPrompt.getRecordStatus())
                    aRecord.startRecording();
                else {
                    aRecord.stopRecording();
                    mealType = getVoiceInput();
                    mealPrompt.setLabel(RESPONSE + mealType);
                    // Prompt user to input ingredient list after finish recording meal type
                    ingredientPrompt.setLabel(INGREDIENT_PROMPT);
                    if (mealType != "" && mealList != "") {
                        doneButton.setDisable(false);
                    }
                }
            } catch (Exception exc) {
                exc.printStackTrace();
            }
        });

        // Record and display user's response for ingredient list
        ingredientMicButton.setOnAction(e -> {
            try {
                ingredientPrompt.toggleRecord();
                if (ingredientPrompt.getRecordStatus())
                    aRecord.startRecording();
                else {
                    aRecord.stopRecording();
                    mealList = getVoiceInput();
                    ingredientPrompt.setLabel(RESPONSE + mealList);
                    if (mealType != "" && mealList != "") {
                        doneButton.setDisable(false);
                    }
                }
            } catch (Exception exc) {
                exc.printStackTrace();
            }
        });

        // Generate and display recipe page
        doneButton.setOnAction(e -> {
            try {
                prc = new postRecipeCreate(mealType, mealList);
                prc.postRecipeCreateDisplay(app);
                inputStage.close();
            } catch (Exception exc) {
                exc.printStackTrace();
            }
        });

        this.getChildren().addAll(mealPrompt, ingredientPrompt, doneButton, recordingLabel);
        this.setSpacing(15);

        scene = new Scene(this, 600, 600);

        inputStage.setTitle("Create Recipe");
        inputStage.setResizable(false);
        inputStage.setScene(scene);
        inputStage.show();
    }

    // Helper method to write a file to the output stream in multipart form data
    // format
    private static void writeFileToOutputStream(OutputStream outputStream,
            File file, String boundary) throws IOException {
        outputStream.write(("--" + boundary + "\r\n").getBytes());
        outputStream.write(
                ("Content-Disposition: form-data; name=\"file\"; filename=\"" +
                        file.getName() + "\"\r\n").getBytes());
        outputStream.write(("Content-Type: audio/mpeg\r\n\r\n").getBytes());

        FileInputStream fileInputStream = new FileInputStream(file);
        byte[] buffer = new byte[1024];
        int bytesRead;
        while ((bytesRead = fileInputStream.read(buffer)) != -1) {
            outputStream.write(buffer, 0, bytesRead);
        }
        fileInputStream.close();
    }

    private String getVoiceInput() throws Exception {
        Whisper voiceInput = new Whisper();
        String path = "recording.wav";
        File file = new File(path);

        URL url = new URI(App.serverURL + "/whisper").toURL();
        HttpURLConnection connection = (HttpURLConnection) url.openConnection();
        connection.setRequestMethod("POST");
        connection.setDoOutput(true);

        // Set up request headers
        String boundary = "Boundary-" + System.currentTimeMillis();
        connection.setRequestProperty(
                "Content-Type",
                "multipart/form-data; boundary=" + boundary);

        // Set up output stream to write request body
        OutputStream outputStream = connection.getOutputStream();

        // Write file parameter to request body
        writeFileToOutputStream(outputStream, file, boundary);

        // Write closing boundary to request body
        outputStream.write(("\r\n--" + boundary + "--\r\n").getBytes());

        // Flush and close output stream
        outputStream.flush();
        outputStream.close();

        // Get response code
        int responseCode = connection.getResponseCode();

        String result = "There was an internal error";
        // Check response code and handle response accordingly
        if (responseCode == HttpURLConnection.HTTP_OK) {
            String response = readStream(connection.getInputStream());
            JSONObject responseJson = new JSONObject(response);
            result = responseJson.getString("text");
        } else {
            String errorResponse = readStream(connection.getErrorStream());
            System.out.println("Failed to generate: " + errorResponse);
        }

        // Disconnect connection
        connection.disconnect();

        return result;
    }

    private String readStream(InputStream inputStream) throws IOException {
        BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream));
        StringBuilder response = new StringBuilder();
        String line;
        while ((line = reader.readLine()) != null) {
            response.append(line);
        }
        reader.close();
        return response.toString();
    }
}

class DetailedViewScreen extends VBox {

    private Button saveRecipeButton;
    private Button editRecipeButton;
    private Button backButton;
    private TextArea recipeDescription;
    private Stage postCreateStage;
    private Scene scene;
    private boolean saveflag;
    private Recipe tempR;

    // display the generated recipe description in a new popout window
    // pmt = passed meal type, pml = passed meal ingredient list
    DetailedViewScreen(Recipe r) {

        tempR = r;
        postCreateStage = new Stage();
        recipeDescription = new TextArea();
        recipeDescription.setWrapText(true);
        recipeDescription.appendText(tempR.getRecipeDescription());
        saveflag = false;
        recipeDescription.setEditable(saveflag);

        saveRecipeButton = new Button("save");
        saveRecipeButton.setPrefSize(45, 15);
        saveRecipeButton.setAlignment(Pos.CENTER);

        editRecipeButton = new Button("edit");
        editRecipeButton.setPrefSize(45, 15);
        editRecipeButton.setAlignment(Pos.CENTER);

        backButton = new Button("back");
        backButton.setPrefSize(45, 15);
        backButton.setAlignment(Pos.CENTER);

        this.setPrefSize(500, 500);
    }

    public void ShowDetailedView(App app) {
        saveRecipeButton.setOnAction(e -> {
            String updatedDesc = recipeDescription.getText();
            tempR.setRecipeDescription(updatedDesc);
            app.writeServerState();

            postCreateStage.close();
        });
        editRecipeButton.setOnAction(e -> {
            if (saveflag == false) {
                saveflag = true;
                recipeDescription.setEditable(saveflag);
            } else {
                saveflag = false;
                recipeDescription.setEditable(saveflag);
            }
        });
        backButton.setOnAction(e -> {
            postCreateStage.close();
        });

        HBox buttonArea = new HBox();
        buttonArea.getChildren().addAll(saveRecipeButton, editRecipeButton, backButton);
        buttonArea.setPadding(new Insets(10, 10, 10, 10));
        buttonArea.setSpacing(199);

        VBox recipeDetail = new VBox();
        recipeDetail.getChildren().addAll(recipeDescription);
        recipeDetail.setPadding(new Insets(10, 10, 10, 10));

        VBox recipeImage = new VBox();
        String fimg = "data:image/jpeg;base64,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";
        Image foodImg = new Image(fimg);
        ImageView imageView = new ImageView(foodImg);
        recipeImage.getChildren().addAll(imageView);
        recipeImage.setAlignment(Pos.CENTER);

        this.getChildren().addAll(buttonArea, recipeDetail, recipeImage);

        scene = new Scene(this, 550, 550);

        postCreateStage.setTitle("Generated Recipe");
        postCreateStage.setResizable(false);
        postCreateStage.setScene(scene);
        postCreateStage.show();
    }
}

// JavaFX Application main entry point
public class App extends Application {

    private newScreen ns;
    private DetailedViewScreen ds;
    public static final String serverURL = "http://127.0.0.1:8100";

    public static void main(String[] args) {
        launch(args);
    }

    private RecipeStateManager state;

    RecipeStateManager getState() {
        return state;
    }

    public VBox recipesUI;

    private String rName;
    private String rDesc;
    private RecipeKind rKind;
    private Server server = new Server();

    public void updateFromServerState() {
        try {
            HttpClient client = HttpClient.newHttpClient();
            // Create the request object
            HttpRequest request = HttpRequest
                    .newBuilder()
                    .uri(new URI(App.serverURL + "/recipestate"))
                    .header("Content-Type", "application/json")
                    .GET().build();
            // Send the request and receive the response
            HttpResponse<String> response = client.send(request, HttpResponse.BodyHandlers.ofString());
            String responseBody = response.body();
            state = JSONOperations.fromJSONString(responseBody);

            for (Recipe r : state.getRecipes()) {
                addRecipeUI(r);
            }
        } catch (Exception e) {
            System.err.println("Failed to update from remote state");
            e.printStackTrace();
            state = new RecipeStateManager();
        }
    }

    public void writeServerState() {
        String toSend = JSONOperations.intoJSONString(state);
        try {
            HttpClient client = HttpClient.newHttpClient();
            // Create the request object
            HttpRequest request = HttpRequest
                    .newBuilder()
                    .uri(new URI(App.serverURL + "/recipestate"))
                    .header("Content-Type", "application/json")
                    .POST(HttpRequest.BodyPublishers.ofString(toSend.toString())).build();
            // Send the request and receive the response
            HttpResponse<String> response = client.send(request, HttpResponse.BodyHandlers.ofString());
        } catch (Exception e) {
            System.err.println("Failed to save remote state");
            e.printStackTrace();
        }
    }

    public void addRecipeUI(Recipe recipe) {
        StackPane recipePane = new StackPane();

        HBox.setHgrow(recipePane, Priority.ALWAYS);

        HBox recipeHbox = new HBox(20.0);
        recipePane.getChildren().add(recipeHbox);
        StackPane.setAlignment(recipeHbox, Pos.CENTER);
        recipeHbox.setStyle("-fx-border-color: black; -fx-border-width: 1;");

        recipeHbox.setMinHeight(100.0);

        {
            VBox recipeImage = new VBox();
            imageGenerate ig = new imageGenerate("ham and cheese sandwich");
            String fimg = ig.generate();
            Image foodImg = new Image(fimg);
            ImageView imageView = new ImageView(foodImg);
            recipeImage.getChildren().addAll(imageView);
            recipeImage.setAlignment(Pos.CENTER);
            recipeHbox.getChildren().add(recipeImage);
        }

        {
            StackPane descPane = new StackPane();
            HBox.setHgrow(descPane, Priority.ALWAYS);

            BorderPane descInside = new BorderPane();
            descInside.setPadding(new Insets(20.0));
            descInside.setStyle("-fx-border-color: black; -fx-border-width: 1;");
            descPane.getChildren().add(descInside);

            // recipe title
            Button title = new Button(recipe.getRecipeName());
            title.setAlignment(Pos.CENTER_LEFT);
            BorderPane.setAlignment(title, Pos.CENTER_LEFT);
            descInside.setLeft(title);
            title.setOnMouseClicked(e -> {
                ds = new DetailedViewScreen(recipe);
                ds.ShowDetailedView(this);
                System.out.println(recipe.getRecipeDescription());
            });
            
            // recipe type
            Label recipeType = new Label(recipe.getRecipeKind().name());
            recipeType.setAlignment(Pos.CENTER_RIGHT);
            BorderPane.setAlignment(recipeType, Pos.CENTER_RIGHT);
            descInside.setRight(recipeType);

            recipeHbox.getChildren().add(descPane);
        }

        {
            StackPane delPane = new StackPane();
            Button deleteButton = new Button("Delete");
            delPane.getChildren().add(deleteButton);
            deleteButton.setOnMouseClicked(e -> {
                state.deleteRecipe(recipe);
                recipesUI.getChildren().remove(recipePane);
                writeServerState();
            });
            delPane.setPadding(new Insets(20.0));
            recipeHbox.getChildren().add(delPane);
        }
        
        recipePane.setPadding(new Insets(20.0));

        recipesUI.getChildren().add(0, recipePane);
    }

    @Override
    public void stop() {
        server.stopServer();
    }

    @Override
    public void start(Stage primaryStage) {
        server.startServer();
        primaryStage.setTitle("Recipe Run");

        VBox mainBox = new VBox();
        mainBox.setAlignment(Pos.TOP_CENTER);

        // top titlebar
        {
            HBox titleHbox = new HBox();
            titleHbox.setAlignment(Pos.CENTER_RIGHT);
            Button newRecipe = new Button("New Recipe");
            newRecipe.setMinHeight(50.0);

            newRecipe.setOnMouseClicked(e -> {
                ns = new newScreen();
                ns.voiceInputScreen(this);
            });

            Region spacer = new Region();
            spacer.setMinWidth(50.0);
            titleHbox.getChildren().addAll(newRecipe, spacer);
            mainBox.getChildren().add(titleHbox);
        }

        recipesUI = new VBox();

        updateFromServerState();

        recipesUI.setAlignment(Pos.TOP_CENTER);
        // mainBox.getChildren().add(scrollPaneContents);
        ScrollPane pane = new ScrollPane();
        pane.viewportBoundsProperty().addListener((observable, oldValue, newValue) -> {
            recipesUI.setPrefWidth(newValue.getWidth() - 1);
        });
        pane.setContent(recipesUI);
        mainBox.getChildren().add(pane);

        Scene scene = new Scene(mainBox, 1280, 720);
        primaryStage.setScene(scene);
        primaryStage.show();
    }
}
